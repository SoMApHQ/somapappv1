<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Money Memory – Society Cashbook</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- Firebase (single, consistent version: v9 compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

  <!-- Your firebase config/initialize file (must call firebase.initializeApp + can set window.db) -->
  <script src="../firebase.js"></script>

  <style>
    body {
      font-family: "Inter", system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 10% 20%, rgba(59,130,246,0.25), transparent 30%),
                  radial-gradient(circle at 90% 10%, rgba(236,72,153,0.2), transparent 32%),
                  radial-gradient(circle at 20% 80%, rgba(16,185,129,0.18), transparent 28%),
                  linear-gradient(135deg, #0b1220, #0f172a 50%, #0b1220);
      color: #e2e8f0;
      min-height: 100vh;
    }
    .glass {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(16px);
      box-shadow: 0 15px 45px rgba(0,0,0,0.25);
    }
    .pill {
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.08);
    }
    .tab-btn.active {
      background: linear-gradient(120deg, #4f46e5, #06b6d4);
      color: #0b1220;
      border-color: transparent;
      box-shadow: 0 10px 30px -12px rgba(79,70,229,0.55);
    }
    .auth-mode-btn {
      transition: all 0.2s ease;
    }
    .auth-mode-btn.active {
      background: linear-gradient(120deg, #22c55e, #0ea5e9);
      color: #0b1220;
      border-color: transparent;
      box-shadow: 0 10px 30px -12px rgba(14,165,233,0.5);
    }

    /* Auth overlay */
    #signin-overlay {
      position: fixed;
      inset: 0;
      background: rgba(7, 11, 23, 0.75);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      z-index: 9999;
    }
    .signin-card {
      background: #ffffff;
      color: #0f172a;
      border-radius: 24px;
      box-shadow: 0 24px 80px rgba(0,0,0,0.35);
      padding: 22px;
      max-width: 420px;
      width: 100%;
    }
    .signin-card h2 {
      font-weight: 800;
      margin-bottom: 12px;
      font-size: 22px;
    }
    .signin-card .hint {
      font-size: 12px;
      color: #64748b;
      margin-bottom: 12px;
    }
    .signin-card input {
      width: 100%;
      padding: 12px 14px;
      padding-right: 56px;
      border-radius: 14px;
      border: 1px solid #e2e8f0;
      margin-bottom: 10px;
      font-size: 14px;
      background: #f8fafc;
      outline: none;
    }
    .signin-card input:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 3px rgba(56,189,248,0.18);
    }
    .signin-card .relative { position: relative; }
    .eye-toggle {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      color: #94a3b8;
      cursor: pointer;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }
    .eye-toggle:hover {
      color: #475569;
      background: rgba(0,0,0,0.06);
    }
    .signin-card button.primary {
      width: 100%;
      background: linear-gradient(120deg, #22c55e, #0ea5e9);
      color: #0b1220;
      font-weight: 800;
      border: none;
      border-radius: 14px;
      padding: 12px 14px;
      cursor: pointer;
      margin-top: 6px;
    }
    .signin-card button.primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .signin-card button.link {
      width: 100%;
      background: none;
      border: none;
      margin-top: 10px;
      color: #0ea5e9;
      cursor: pointer;
      font-weight: 700;
      text-align: center;
    }
    .msg { font-size: 13px; text-align: center; margin-top: 10px; }
    .hidden { display: none; }
  </style>
</head>

<body>
  <!-- Auth overlay -->
  <div id="signin-overlay">
    <div class="signin-card">
      <div id="signin-box">
        <h2>Money Memory Access</h2>
        <div class="hint">Choose Sign in or Register. Recovery answer lets you reset later.</div>

        <div class="flex items-center gap-2 mb-2">
          <button id="auth-mode-signin" type="button" class="auth-mode-btn pill px-3 py-2 rounded-lg text-sm font-semibold active">Sign in</button>
          <button id="auth-mode-register" type="button" class="auth-mode-btn pill px-3 py-2 rounded-lg text-sm font-semibold">Register</button>
        </div>

        <input id="cashName" placeholder="Your name" autocomplete="username" />

        <div class="relative">
          <input id="cashPass" type="password" placeholder="Password" autocomplete="current-password" />
          <button type="button" class="eye-toggle" data-target="cashPass" aria-label="Toggle password visibility">
            <i class="fa fa-eye"></i>
          </button>
        </div>

        <div id="repeat-password-block" class="relative auth-register-only hidden">
          <input id="cashPassRepeat" type="password" placeholder="Repeat password (for registration)" autocomplete="new-password" />
          <button type="button" class="eye-toggle" data-target="cashPassRepeat" aria-label="Toggle password visibility">
            <i class="fa fa-eye"></i>
          </button>
        </div>

        <input id="cashRecovery" class="auth-register-only hidden" placeholder="Recovery answer" autocomplete="off" />

        <button id="signinBtn" type="button" class="primary">Sign In</button>
        <div id="authMsg" class="msg hidden"></div>

        <button id="forgotLink" type="button" class="link">Forgot password?</button>
      </div>

      <div id="recover-box" class="hidden">
        <h2>Recover Password</h2>
        <div class="hint">Answer your recovery question and set a new password.</div>

        <input id="recoverName" placeholder="Your name" autocomplete="username" />
        <input id="recoveryInput" placeholder="Recovery answer" />

        <div class="relative">
          <input id="recoverNewPass" type="password" placeholder="New password" autocomplete="new-password" />
          <button type="button" class="eye-toggle" data-target="recoverNewPass" aria-label="Toggle password visibility">
            <i class="fa fa-eye"></i>
          </button>
        </div>

        <div class="relative">
          <input id="recoverNewPassRepeat" type="password" placeholder="Repeat new password" autocomplete="new-password" />
          <button type="button" class="eye-toggle" data-target="recoverNewPassRepeat" aria-label="Toggle password visibility">
            <i class="fa fa-eye"></i>
          </button>
        </div>

        <button id="recoverBtn" type="button" class="primary">Reset Password</button>
        <div id="recoverMsg" class="msg hidden"></div>

        <button id="backToSignin" type="button" class="link">Back to sign in</button>
      </div>
    </div>
  </div>

  <!-- App -->
  <div class="max-w-6xl mx-auto px-4 py-8">
    <header class="glass rounded-2xl p-4 md:p-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-4">
        <a href="../index.html" class="text-sky-300 hover:text-white text-sm font-semibold flex items-center gap-2">
          <span class="text-lg">←</span> Back to SoMAp
        </a>
        <div>
          <p class="text-xs uppercase tracking-[0.25em] text-slate-300">Money Memory</p>
          <h1 class="text-2xl md:text-3xl font-extrabold text-white leading-tight">Society Cashbook</h1>
          <p class="text-sm text-slate-300">Track income, expenses, budgets, timeline and pots.</p>
        </div>
      </div>

      <div class="flex flex-wrap gap-3 items-center">
        <div id="mm-mode-pill" class="pill px-3 py-1 rounded-full text-sm text-slate-100">Guest mode</div>

        <div id="mm-user-chip" class="hidden items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10">
          <button id="mm-avatar-btn" type="button" class="w-9 h-9 rounded-full bg-white/10 overflow-hidden grid place-items-center hover:bg-white/20" title="Change profile photo">
            <img id="mm-user-avatar" src="" alt="Profile" class="w-full h-full object-cover hidden">
            <i id="mm-user-avatar-icon" class="fa fa-user text-slate-200 text-sm"></i>
          </button>
          <div class="leading-tight">
            <div id="mm-user-name" class="text-white text-sm font-bold"></div>
            <div class="text-slate-300 text-xs">Profile</div>
          </div>
          <input id="mm-avatar-input" type="file" accept="image/*" class="hidden">
        </div>

        <select id="mm-cashbook-select" class="bg-white/10 border border-white/20 rounded-xl px-3 py-2 text-sm text-white min-w-[180px]">
          <option>Loading...</option>
        </select>

        <div class="relative">
          <button id="mm-menu-btn" class="p-2 rounded-full hover:bg-white/10 text-white" type="button">
            <i class="fas fa-ellipsis-vertical"></i>
          </button>

          <div id="mm-menu" class="hidden absolute right-0 mt-2 w-56 glass rounded-xl overflow-hidden text-sm">
            <a class="block px-4 py-3 hover:bg-white/10" href="society_planner.html">Planner & Calculator</a>
            <a class="block px-4 py-3 hover:bg-white/10" href="society_statement.html">Statement</a>
            <a class="block px-4 py-3 hover:bg-white/10" href="society_shared.html">Shared Book</a>
            <a class="block px-4 py-3 hover:bg-white/10" href="society_settings.html">Settings</a>
            <div class="border-t border-white/10"></div>
            <button id="mm-logout-btn" class="hidden w-full text-left px-4 py-3 hover:bg-white/10 text-rose-200" type="button">Logout</button>
          </div>
        </div>
      </div>
    </header>

    <!-- Summary cards -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
      <article class="glass rounded-2xl p-4 md:p-5 border border-indigo-500/30">
        <p class="text-xs text-slate-300 uppercase tracking-[0.2em]">Current Balance</p>
        <p id="mm-net-balance" class="text-3xl md:text-4xl font-extrabold mt-2">–</p>
        <p class="text-sm text-slate-400">Opening + income - expenses</p>
      </article>

      <article class="glass rounded-2xl p-4 md:p-5 border border-emerald-500/30">
        <p class="text-xs text-slate-300 uppercase tracking-[0.2em]">This Month Income</p>
        <p id="mm-income-month-main" class="text-3xl md:text-4xl font-extrabold mt-2">–</p>
        <p id="mm-income-month-sub" class="text-sm text-slate-400">This week: – • Today: –</p>
      </article>

      <article class="glass rounded-2xl p-4 md:p-5 border border-rose-500/30">
        <p class="text-xs text-slate-300 uppercase tracking-[0.2em]">This Month Expenses</p>
        <p id="mm-expense-month-main" class="text-3xl md:text-4xl font-extrabold mt-2">–</p>
        <p id="mm-expense-month-sub" class="text-sm text-slate-400">This week: – • Today: –</p>
      </article>
    </section>

    <!-- Tabs -->
    <nav class="flex flex-wrap gap-2 mt-8">
      <button class="tab-btn active px-4 py-2 rounded-xl border border-white/10 text-sm font-semibold" data-mm-tab="summary" type="button">Summary</button>
      <button class="tab-btn px-4 py-2 rounded-xl border border-white/10 text-sm font-semibold" data-mm-tab="transactions" type="button">Transactions</button>
      <button class="tab-btn px-4 py-2 rounded-xl border border-white/10 text-sm font-semibold" data-mm-tab="budgets" type="button">Budgets</button>
      <button class="tab-btn px-4 py-2 rounded-xl border border-white/10 text-sm font-semibold" data-mm-tab="timeline" type="button">Timeline</button>
      <button class="tab-btn px-4 py-2 rounded-xl border border-white/10 text-sm font-semibold" data-mm-tab="pots" type="button">Pots</button>
      <button class="tab-btn px-4 py-2 rounded-xl border border-white/10 text-sm font-semibold" data-mm-tab="tools" type="button">Tools</button>
    </nav>

    <section id="tab-summary" class="mt-5 grid grid-cols-1 md:grid-cols-2 gap-4">
      <article class="glass rounded-2xl p-4">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-bold text-white">Today</h3>
          <span class="text-xs pill px-3 py-1 rounded-full text-slate-200">Today</span>
        </div>
        <div id="mm-today-quick" class="mt-3 text-sm text-slate-300">-</div>
        <div class="divider border-t border-white/10 mt-4"></div>
        <div class="mt-4">
          <p class="text-sm text-slate-300 font-semibold mb-2">Top Pots (month)</p>
          <div id="mm-top-pots" class="space-y-2"></div>
        </div>
      </article>

      <article class="glass rounded-2xl p-4">
        <h3 class="text-lg font-bold text-white">Quick Notes</h3>
        <div id="mm-summary-chart" class="mt-3 text-slate-300 text-sm">
          Your summary blocks can expand here later.
        </div>
      </article>
    </section>

    <section id="tab-transactions" class="mt-6 hidden">
      <div class="glass rounded-2xl p-4">
        <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
          <h3 class="text-lg font-bold text-white">Add Transaction</h3>
          <div class="pill px-3 py-1 rounded-full text-xs text-slate-200">Income or Expense</div>
        </div>

        <form id="mm-add-transaction" class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <div class="flex gap-2">
            <label class="pill px-3 py-2 rounded-lg flex items-center gap-2 text-sm cursor-pointer">
              <input type="radio" name="direction" value="in" checked> Income
            </label>
            <label class="pill px-3 py-2 rounded-lg flex items-center gap-2 text-sm cursor-pointer">
              <input type="radio" name="direction" value="out"> Expense
            </label>
          </div>

          <input id="mm-amount" type="number" required placeholder="Amount" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm text-white">
          <input id="mm-date" type="date" required class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm text-white">
          <input id="mm-time" type="time" required class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm text-white">
          <input id="mm-pot" type="text" placeholder="Pot (e.g. Home)" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm text-white">
          <input id="mm-category" type="text" placeholder="Category" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm text-white">
          <input id="mm-note" type="text" placeholder="Note" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm text-white">

          <select id="mm-method" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm text-white">
            <option value="cash">Cash</option>
            <option value="mpesa">M-Pesa</option>
            <option value="bank">Bank</option>
            <option value="other">Other</option>
          </select>

          <button type="submit" class="bg-gradient-to-r from-emerald-400 to-sky-500 text-slate-900 font-semibold rounded-lg px-4 py-2">
            Save Transaction
          </button>
        </form>
      </div>

      <div class="glass rounded-2xl p-4 mt-4">
        <h3 class="text-lg font-bold text-white mb-3">Transactions</h3>
        <div id="mm-transaction-list" class="space-y-3 text-sm text-slate-200"></div>
      </div>
    </section>

    <section id="tab-budgets" class="mt-6 hidden">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-bold text-white">Budgets</h3>
        <button id="mm-add-budget" class="pill px-3 py-2 rounded-lg text-sm text-slate-100" type="button">Add Budget</button>
      </div>
      <div id="mm-budgets" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
    </section>

    <section id="tab-timeline" class="mt-6 hidden">
      <h3 class="text-lg font-bold text-white mb-3">Timeline</h3>
      <div id="mm-timeline" class="space-y-3"></div>
    </section>

    <section id="tab-pots" class="mt-6 hidden">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-bold text-white">Pots</h3>
        <button id="mm-add-pot" class="pill px-3 py-2 rounded-lg text-sm text-slate-100" type="button">Add Pot</button>
      </div>
      <div id="mm-pots" class="grid grid-cols-1 md:grid-cols-3 gap-3"></div>
    </section>

    <section id="tab-tools" class="mt-6 hidden">
      <h3 class="text-lg font-bold text-white mb-3">Tools</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <a href="society_planner.html" class="glass rounded-xl p-4 hover:border-emerald-400/50 border border-white/10">
          <p class="text-sm text-emerald-200 font-semibold">Planner & Calculator</p>
          <p class="text-slate-200 text-sm mt-1">Plan days and split budgets.</p>
        </a>
        <a href="society_statement.html" class="glass rounded-xl p-4 hover:border-sky-400/50 border border-white/10">
          <p class="text-sm text-sky-200 font-semibold">Statement</p>
          <p class="text-slate-200 text-sm mt-1">Print or download your statement.</p>
        </a>
        <a href="society_shared.html" class="glass rounded-xl p-4 hover:border-indigo-400/50 border border-white/10">
          <p class="text-sm text-indigo-200 font-semibold">Shared Book</p>
          <p class="text-slate-200 text-sm mt-1">View a shared cashbook.</p>
        </a>
        <a href="society_settings.html" class="glass rounded-xl p-4 hover:border-amber-400/50 border border-white/10">
          <p class="text-sm text-amber-200 font-semibold">Settings</p>
          <p class="text-slate-200 text-sm mt-1">Currency, language, week start.</p>
        </a>
      </div>
    </section>
  </div>

  <!-- Single app script -->
  <script defer src="./js/societycashbook.js"></script>
</body>
</html>
